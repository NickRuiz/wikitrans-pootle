{% load i18n render_pager baseurl store_tags cache %}
{% get_current_language as LANGUAGE_CODE %}
{% get_current_language_bidi as LANGUAGE_BIDI %}
<!-- JS templates: move from here when possible -->
<script id="view_unit" type="text/x-jquery-template">
<td class="translation-action">
  <a title="{% trans 'Edit translation' %}" id="editlink${unit.id}" href="?unit=${unit.id}">
    <img src="{{ 'images/pencil.png'|m }}" />
  </a>
</td>
<td dir="${meta.source_dir}" class="translate-original" rowspan="1" colspan="1">
  <div class="translate-original translate-view" id="orig${unit.id}">
    [[each(i, source) unit.source]]
    [[if source.title]]
    <span class="translation-text-headers" lang="${meta.source_lang}">${ source.title }</span>
    [[/if]]
    <div lang="${meta.source_lang}" dir="${meta.source_dir}" class="translation-text">[[html source.text]]</div>
    [[/each]]
  </div>
</td>
<td dir="${meta.target_dir}" class="translate-translation" rowspan="1" colspan="1">
  <div dir="${meta.target_dir}" class="translate-translation translate-view" id="trans${unit.id}">
    [[each(i, target) unit.target]]
    [[if target.title]]
    <span class="translation-text-headers" lang="${meta.target_lang}">${ target.title }</span>
    [[/if]]
    <div lang="${meta.target_lang}" class="translation-text" dir="${meta.target_dir}">[[html target.text]]</div>
    [[/each]]
  </div>
</td>
</script>
<!-- TODO: Provide localized texts -->
<script id="pager" type="text/x-jquery-template">
<ul class="pager">
  [[if pager.has_previous]]
  <li><a href="?page=1" class="nth-link">First</a></li>
  <li><a href="?page=${pager.pp_number}" class="nth-link">Previous</a></li>
  [[/if]]
  [[if pager.start > 1]]
  <li>...</li>
  [[/if]]
  [[each(i, page) pager.pages]]
  [[if page == pager.number]]
  <li><span class="current-link">${ page }</span></li>
  [[else]]
  <li><a href="?page=${ page }" class="number-link">${ page }</a></li>
  [[/if]]
  [[/each]]
  [[if pager.end < pager.num_pages]]
  <li>...</li>
  [[/if]]
  [[if pager.has_next]]
  <li><a href="?page=${pager.np_number}" class="nth-link">Next</a></li>
  <li><a href="?page=${pager.num_pages}" class="nth-link">Last (${pager.num_pages})</a></li>
  [[/if]]
</ul>
</script>
<div class="translation-nav">
  {{ pager|render_pager }}
</div>
<div class="translate-form">
    <div id="pootle_path" class="hide">{{ store.pootle_path }}</div>
    <div id="active_uid" class="hide">{{ form.instance.id }}</div>
    <div id="num_pages" class="hide">{{ pager.num_pages }}</div>
    <table cellpadding="0" cellspacing="0" class="translate-table" dir="{% if LANGUAGE_BIDI %}rtl{% else %}ltr{% endif %}">
      <thead>
        <tr lang="{{ LANGUAGE_CODE }}">
          <th colspan="1" rowspan="1" class="translate-table-title translate-edit"></th>
          <th colspan="1" rowspan="1" class="translate-table-title translate-original"></th>
          <th colspan="1" rowspan="1" class="translate-table-title translate-translation"></th>
        </tr>
      </thead>
      <tbody>
        {% for unit in units %}
        <tr id="row{{ unit.id }}" class="{% cycle 'even' 'odd' %}{% ifequal unit form.instance %} translate-translation-row{% endifequal %}{% if unit.isfuzzy %} translate-translation-fuzzy{% endif %}"{% ifequal unit form.instance %} colspan="2"{% endifequal %}>
          {% ifnotequal unit form.instance %}
          <td class="translation-action">
            <a href="?unit={{ unit.id }}" id="editlink{{ unit.id }}" title="{% trans 'Edit translation' %}">
            <img src="{{ 'images/pencil.png'|m }}" />
            </a>
          </td>
          {% endifnotequal %}
          {% ifequal unit form.instance %}
            {% cache settings.CACHE_TIMEOUT unit_edit unit.id unit.mtime cantranslate cansuggest canreview alt_src_codes profile.id LANGUAGE_CODE %}
            {% render_unit_edit form %}
            {% endcache %}
          {% else %}
            {% cache settings.CACHE_TIMEOUT unit_view unit.id unit.mtime LANGUAGE_CODE %}
            {% render_unit_view unit %}
            {% endcache %}
          {% endifequal %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
</div>
<div class="translation-nav">
{{ pager|render_pager }}
</div>
