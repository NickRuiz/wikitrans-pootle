{% load i18n render_pager baseurl store_tags cache %}
{% get_current_language as LANGUAGE_CODE %}
{% get_current_language_bidi as LANGUAGE_BIDI %}
<!-- JS templates: move from here when possible -->
<script id="unit_view" type="text/x-jquery-template">
<td class="translation-action">
  <a title="{% trans 'Edit translation' %}" id="editlink${id}" href="?unit=${id}">
    <img src="{{ 'images/pencil.png'|m }}" />
  </a>
</td>
<td dir="${store.source_dir}" class="translate-original" rowspan="1" colspan="1">
  <div class="translate-original translate-view" id="orig${id}">
    [[each(i, source) source]]
    [[if source.title]]
    <span class="translation-text-headers" lang="${store.source_lang}">${ source.title }</span>
    [[/if]]
    <div lang="${store.source_lang}" dir="${store.source_dir}" class="translation-text">[[html source.text]]</div>
    [[/each]]
  </div>
</td>
<td dir="${store.target_dir}" class="translate-translation" rowspan="1" colspan="1">
  <div dir="${store.target_dir}" class="translate-translation translate-view" id="trans${id}">
    [[each(i, target) target]]
    [[if target.title]]
    <span class="translation-text-headers" lang="${target_lang}">${ target.title }</span>
    [[/if]]
    <div lang="${store.target_lang}" class="translation-text" dir="${target_dir}">[[html target.text]]</div>
    [[/each]]
  </div>
</td>
</script>
<div class="translation-nav">
  {{ pager|render_pager }}
</div>
<div class="translate-form">
    <div id="store" class="hide">{{ store }}</div>
    <div id="path" class="hide">{{ store|l }}</div>
    <div id="pootle_path" class="hide">{{ store.pootle_path }}</div>
    <div id="active_uid" class="hide">{{ form.instance.id }}</div>
    <table cellpadding="0" cellspacing="0" class="translate-table" dir="{% if LANGUAGE_BIDI %}rtl{% else %}ltr{% endif %}">
      <tr lang="{{ LANGUAGE_CODE }}">
        <th colspan="1" rowspan="1" class="translate-table-title translate-edit"></th>
        <th colspan="1" rowspan="1" class="translate-table-title translate-original"></th>
        <th colspan="1" rowspan="1" class="translate-table-title translate-translation"></th>
      </tr>
      {% for unit in units %}
      <tr id="row{{ unit.id }}" class="{% cycle 'even' 'odd' %}{% ifequal unit form.instance %} translate-translation-row{% endifequal %}{% if unit.isfuzzy %} translate-translation-fuzzy{% endif %}"{% ifequal unit form.instance %} colspan="2"{% endifequal %}>
        {% ifnotequal unit form.instance %}
        <td class="translation-action">
          <a href="?unit={{ unit.id }}" id="editlink{{ unit.id }}" title="{% trans 'Edit translation' %}">
          <img src="{{ 'images/pencil.png'|m }}" />
          </a>
        </td>
        {% endifnotequal %}
        {% ifequal unit form.instance %}
          {% cache settings.CACHE_TIMEOUT unit_edit unit.id unit.mtime cantranslate cansuggest canreview alt_src_codes profile.id LANGUAGE_CODE %}
          {% render_unit_edit form %}
          {% endcache %}
        {% else %}
          {% cache settings.CACHE_TIMEOUT unit_view unit.id unit.mtime LANGUAGE_CODE %}
          {% render_unit_view unit %}
          {% endcache %}
        {% endifequal %}
      </tr>
      {% endfor %}
    </table>
</div>
<div class="translation-nav">
{{ pager|render_pager }}
</div>
